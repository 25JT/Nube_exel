<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
</head>
<body>
    <div class="container mt-4">
        <h1 class="text-center mb-4">Inventario</h1>

        <!-- Barra de b√∫squeda -->
        <div class="mb-4">
            <input type="text" id="search-input" class="form-control" placeholder="Buscar producto...">
        </div>

        <div class="row" id="product-container"></div>
    </div>

    <script>
     //  const url = `http://localhost:3000/inventario`; //node index.js   //http://localhost:3000/inventario

     const container = document.getElementById("product-container");
const searchInput = document.getElementById("search-input");

function displayProducts(filteredProducts) {
    container.innerHTML = "";

    if (filteredProducts.length === 0) {
        // Si no hay coincidencias, mostrar un mensaje
        const noResultDiv = document.createElement("div");
        noResultDiv.className = "col-12 text-center mt-4";
        noResultDiv.innerHTML = `<h5 class="text-danger">‚ùå No se encontraron productos con ese nombre.</h5>`;
        container.appendChild(noResultDiv);
        return;
    }

    filteredProducts.forEach(product => {
        const colDiv = document.createElement("div");
        colDiv.className = "col-md-4 mb-4";

        const cardDiv = document.createElement("div");
        cardDiv.className = "card h-100 shadow-sm";

        const img = document.createElement("img");
        img.className = "card-img-top";
        img.src = product.imgSrc;
        img.alt = product.title;
        img.style.objectFit = "cover";
        img.style.height = "200px";

        const cardBody = document.createElement("div");
        cardBody.className = "card-body text-center";

        const cardTitle = document.createElement("h5");
        cardTitle.className = "card-title";
        cardTitle.innerText = product.title;

        const cardText = document.createElement("p");
        cardText.className = "card-text fw-bold";
        cardText.innerText = product.price;

        cardBody.appendChild(cardTitle);
        cardBody.appendChild(cardText);
        cardDiv.appendChild(img);
        cardDiv.appendChild(cardBody);
        colDiv.appendChild(cardDiv);
        container.appendChild(colDiv);
    });
}

let products = [];

fetch("http://localhost:3000/inventario")
    .then(response => response.json())
    .then(data => {
        console.log("üîç Respuesta de la API:", data);

        if (!data || typeof data !== "object") {
            console.error("‚ùå No se encontraron datos v√°lidos en la API.");
            return;
        }

        const values = Array.isArray(data.values) ? data.values : Object.values(data);
        console.log("‚úÖ Datos organizados en filas:", values);

        if (!Array.isArray(values) || values.length === 0) {
            console.error("‚ùå No hay datos v√°lidos en la respuesta.");
            return;
        }

        const headers = values[0] && typeof values[0] === "object" ? Object.keys(values[0]) : [];
        console.log("üìù Encabezados detectados:", headers);

        const productoIndex = headers.indexOf("title");
        const coloresIndex = headers.indexOf("colores");
        const paquetesIndex = headers.indexOf("paquetes");
        const precioIndex = headers.indexOf("price");
        const urlIndex = headers.indexOf("imgSrc");

        if ([productoIndex, coloresIndex, paquetesIndex, precioIndex, urlIndex].includes(-1)) {
            console.error("‚ùå Error: Algunos nombres de columnas no coinciden.");
            return;
        }

        function fixDriveUrl(driveUrl) {
            if (!driveUrl) return "";
            let match = driveUrl.match(/(?:id=|\/d\/)([a-zA-Z0-9_-]+)(?:\/view|\?|$)/);
            return match && match[1] ? `https://drive.google.com/thumbnail?export=view&id=${match[1]}` : driveUrl;
        }

        products = values.slice(1).map(row => ({
            title: row['title']?.trim() || "Sin nombre",
            colores: row['colores']?.trim() || "N/A",
            paquetes: row['paquetes']?.trim() || "N/A",
            price: `$${row['price']?.trim() || "N/A"}`,
            imgSrc: fixDriveUrl(row['imgSrc']?.trim() || ""),
        }));

        console.log("üì¶ Productos procesados:", products);
        products.sort((a, b) => a.title.localeCompare(b.title));
        displayProducts(products);
    })
    .catch(error => console.error("üö® Error con la API:", error));

searchInput.addEventListener("input", function () {
    const searchTerm = searchInput.value.toLowerCase();
    const filteredProducts = products.filter(product =>
        product.title.toLowerCase().includes(searchTerm)
    );
    displayProducts(filteredProducts);
});


    </script>
    
   

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
